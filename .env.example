# Server
NODE_ENV=development
# PORT is auto-detected from environment in production (Dewacloud injects it)
# For local dev, defaults to 3001
PORT=3001

# Production Notes:
# - Set NODE_ENV=production in Dewacloud
# - Don't set PORT in Dewacloud (auto-injected)
# - Set CORS_ORIGIN to your frontend domain
# - Set COOKIE_SECURE=true for HTTPS
# - Set COOKIE_SAMESITE=None for cross-domain (if FE separate) or Lax (if same domain)

# Frontend App
APP_URL=http://localhost:5173
APP_DOMAIN=localhost

# Media Storage Configuration
# Base URL for serving uploaded media files (images, audio)
# Development: Uses http://localhost:3001 by default (no need to set)
# Production: Set to your backend URL or leave empty for relative paths (reverse proxy setup)
# Examples:
#   - Separate backend domain: MEDIA_BASE_URL=https://api.yourdomain.com
#   - Same domain (reverse proxy): MEDIA_BASE_URL= (leave empty)
MEDIA_BASE_URL=

# Storage Driver (default: local)
# Options: 'local' or 's3'
# Use 's3' for AWS S3 storage (requires AWS credentials)
STORAGE_DRIVER=local

# Media Upload Size Limits (in MB)
# Maximum file size for image uploads
MEDIA_MAX_IMAGE_MB=5
# Maximum file size for audio uploads
MEDIA_MAX_AUDIO_MB=15

# Allowed Media File Formats (comma-separated MIME types)
# Allowed image formats (JPEG, PNG, WebP, GIF)
# Default: image/jpeg,image/png,image/webp,image/gif
MEDIA_ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp,image/gif
# Allowed audio formats (MP3, WAV, OGG)
# Default: audio/mpeg,audio/wav,audio/ogg
MEDIA_ALLOWED_AUDIO_TYPES=audio/mpeg,audio/wav,audio/ogg

# Cloudflare R2 / S3-compatible storage (used when STORAGE_DRIVER=s3)
# R2 endpoint, e.g. https://<accountid>.r2.cloudflarestorage.com
R2_ENDPOINT=
# Bucket name in R2
R2_BUCKET_NAME=
# Access key credentials for R2 API
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
# Public base URL for serving files (can be custom domain or R2 public URL)
# Example: https://media.yourdomain.com or https://<accountid>.r2.cloudflarestorage.com/<bucket>
R2_PUBLIC_BASE_URL=

# Database
# Example for Postgres
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/nova_english?schema=public

# Auth / JWT & Cookies
JWT_SECRET=replace-with-a-long-random-string
COOKIE_NAME=nova_auth
REFRESH_COOKIE_NAME=ne_refresh
# In dev (no https), keep Secure=false and SameSite=Lax
COOKIE_SECURE=false
COOKIE_SAMESITE=Lax

# Token Duration (in days)
# Access token duration - used for both JWT expiry and cookie maxAge
# Recommended for security: 0.125 (3 hours) or 0.25 (6 hours)
# Note: Values below 0.1 may cause issues with JWT library
ACCESS_TOKEN_DAYS=0.125

# Refresh token duration - allows getting new access token without re-login
# Recommended: 7-30 days
REFRESH_TOKEN_DAYS=30

# SMTP (for verification/reset emails)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=you@example.com
SMTP_PASS=app-password-or-secret
SMTP_FROM=Nova English <no-reply@localhost>

# Token Expirations (in minutes)
# Email verification token expiry
# Default: 30 minutes
# Production: 15-60 minutes recommended
EMAIL_VERIFICATION_EXPIRES_MINUTES=30

# Password reset token expiry  
# Default: 30 minutes
# Production: 15-30 minutes recommended (security best practice)
PASSWORD_RESET_EXPIRES_MINUTES=30

# CORS Configuration
# Frontend origin that's allowed to access the API
# Development: http://localhost:5173
# Production: https://yourdomain.com
CORS_ORIGIN=http://localhost:5173
# Deprecated: Use CORS_ORIGIN instead (kept for backward compatibility)
# ALLOWED_ORIGIN=http://localhost:5173

# Rate limiting
RATE_LIMIT_LOGIN_WINDOW_MS=60000
RATE_LIMIT_LOGIN_MAX=5
RATE_LIMIT_FORGOT_WINDOW_MS=60000
RATE_LIMIT_FORGOT_MAX=3

# ===== Automated Cleanup Configuration =====

# Secret key for authenticating cleanup API endpoints
# Used by external schedulers (Vercel Cron, GitHub Actions, etc.)
# Generate a random strong secret for production
CRON_SECRET=replace-with-a-secret

# User Cleanup Settings
# Delete unverified users after this many days of inactivity
# Default: 30 days
UNVERIFIED_USER_CLEANUP_DAYS=30

# Refresh Token Cleanup Settings  
# Delete revoked refresh tokens after this many days
# Default: 7 days (keep for audit trail)
REFRESH_TOKEN_CLEANUP_DAYS=7

# Test Data Cleanup Settings
# Delete temporary test answers and incomplete test records after this many days
# This affects:
#   - Temporary answers (draft answers during test)
#   - Expired test sessions
#   - Incomplete test attempts (started but not completed)
# Default: 30 days (monthly cleanup)
# Production: 30 days recommended to allow students to return
TEST_DATA_CLEANUP_DAYS=30

# Historical Test Result Cleanup Settings
# Delete old completed test records and their attempts after this many months
# This affects:
#   - TestRecord rows older than the retention window
#   - TestAttempt rows linked to those records
# Default: 12 months (keep up to one year of history)
TEST_RESULT_RETENTION_MONTHS=12

# ===== Cleanup Scheduler Setup Guide =====
# Run these endpoints from your platform's task scheduler (Vercel Cron, GitHub Actions, etc.)
# All requests require header: x-cron-secret: <your-CRON_SECRET>

# 1. Test Data Cleanup (Recommended: Daily at 2 AM)
#    Endpoint: GET /api/cron/cleanup-answers
#    Deletes: Old temporary answers, expired sessions, incomplete test attempts, empty test records
#    Uses: TEST_DATA_CLEANUP_DAYS setting

# 2. Refresh Token Cleanup (Recommended: Weekly)
#    Endpoint: POST /api/auth/cleanup-refresh-tokens
#    Deletes: Revoked refresh tokens older than retention period
#    Uses: REFRESH_TOKEN_CLEANUP_DAYS setting

# 3. Unverified User Cleanup (Recommended: Monthly)
#    Endpoint: POST /api/auth/cleanup-unverified
#    Deletes: Users who never verified email after retention period
#    Uses: UNVERIFIED_USER_CLEANUP_DAYS setting

# 4. Token Cleanup (Recommended: Monthly)
#    Endpoints:
#      - POST /api/auth/cleanup-verification-tokens (delete expired verification tokens)
#      - POST /api/auth/cleanup-reset-tokens        (delete expired password reset tokens)
#    Uses: Built-in expiration timestamps

# 5. Historical Test Result Cleanup (Recommended: Monthly or Quarterly)
#    Endpoint: POST /api/cron/cleanup-results
#    Deletes: Old TestRecord and TestAttempt data beyond retention window
#    Uses: TEST_RESULT_RETENTION_MONTHS setting